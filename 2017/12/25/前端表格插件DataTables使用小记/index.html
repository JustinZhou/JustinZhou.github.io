<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我要一步一步往上爬，在最高点乘着叶片往前飞"><title>前端表格插件DataTables使用小记 | 红尘漫步</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">前端表格插件DataTables使用小记</h1><a id="logo" href="/.">红尘漫步</a><p class="description">爱吃鱼的小强</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">前端表格插件DataTables使用小记</h1><div class="post-meta">Dec 25, 2017<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/12/25/前端表格插件DataTables使用小记/" href="/2017/12/25/前端表格插件DataTables使用小记/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#整体框架"><span class="toc-number">1.</span> <span class="toc-text">整体框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据绑定与配置文件的定义"><span class="toc-number">2.</span> <span class="toc-text">数据绑定与配置文件的定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#前端数据定制化"><span class="toc-number">3.</span> <span class="toc-text">前端数据定制化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#服务器端分页"><span class="toc-number">4.</span> <span class="toc-text">服务器端分页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一点建议"><span class="toc-number">5.</span> <span class="toc-text">一点建议</span></a></li></ol></div></div><div class="post-content"><p>最近在做一个网站的改版项目，开了一次需求会（尼玛需求文档都没有，对着PS图呱呱了半天），给了一个月时间，100多个页面，几十个特效，而且最坑爹的是80%都是前端工作。当时内心真的是有千万只草泥马在奔腾。额，扯远了…回到正题，由于之前的项目代码比较老旧而且不易于扩展和维护，所以需要重建项目并且要做到模块化及可配置。网站中用到了大量的表格来显示数据并且这些表格定义有可能经常需要变动，所以领导的意思是最好能将其做成可配置易于维护和改动的。经过一番搜索，最终确定了用一款jquery表格插件<a href="http://datatables.club/index.html" target="_blank" rel="external">Datatables</a>。它是一个高度灵活的工具，可以将任何HTML表格添加高级的交互功能。<br><a id="more"></a></p>
<p>至于Datatables简单的应用就不再赘述，可参考它的官方文档。这里讲述一下在项目中应用时遇到的一些问题以及解决办法。</p>
<h2 id="整体框架"><a href="#整体框架" class="headerlink" title="整体框架"></a>整体框架</h2><p>由于网站的并发数据访问量比较大，而且已经有了通用的做过抗压处理的数据接口（以web API的形式提供）。所以我们只需要关注怎么实现将数据接口的数据实时动态可配置的呈现出来。<br><img src="/img/datatables_overview.png" alt="整体框架图"></p>
<h2 id="数据绑定与配置文件的定义"><a href="#数据绑定与配置文件的定义" class="headerlink" title="数据绑定与配置文件的定义"></a>数据绑定与配置文件的定义</h2><p>数据接口返回的数据格式类似于数据库中一行一行的数据，并且大多数接口是通用的。而且对于返回的数据，不同的表格需要显示的列是不一样的。如下图所示：<br><img src="/img/datatables_tableDef.png" alt="数据接口与表格"><br>由于返回的数据并非Json格式的数据，所以数据绑定采用了数组的形式。</p>
<p>为了做到完全的可配置化，定义的配置文件格式如下：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"tbReqParams"</span>: [</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"tableName"</span>: <span class="string">"table1"</span>,</div><div class="line">        <span class="attr">"requestParam"</span>: <span class="string">"xxxx"</span>,</div><div class="line">        <span class="attr">"columns"</span>: <span class="string">"1-2-3-5-4"</span></div><div class="line">      &#125;,</div><div class="line">      &#123;</div><div class="line">        <span class="attr">"tableName"</span>: <span class="string">"table2"</span>,</div><div class="line">        <span class="attr">"requestParam"</span>: <span class="string">"xxxx"</span>,</div><div class="line">        <span class="attr">"columns"</span>: <span class="string">"1-2-5-6-8"</span></div><div class="line">      &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">"creatRowCallback"</span>: <span class="string">"renderTableHelper.createRow"</span>,</div><div class="line">    <span class="attr">"dtb"</span>: &#123;</div><div class="line">      <span class="attr">"columns"</span>: [</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"市场"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(MarketType)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">0</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"代码"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(Code)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">1</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"名称"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(Name)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">2</span>,</div><div class="line">          <span class="attr">"render"</span>: <span class="string">"renderCommon.getCommonCodeLink"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"最新价"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(Close)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">3</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"涨跌幅"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(ChangePercent)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">4</span>,</div><div class="line">          <span class="attr">"render"</span>: <span class="string">"renderCommon.getChangePercent"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"涨跌额"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(Change)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">5</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"最高"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(High)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">6</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"最低"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(Low)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>: <span class="number">7</span></div><div class="line">        &#125;,</div><div class="line">		&#123;</div><div class="line">          <span class="attr">"title"</span>: <span class="string">"换手率"</span>,</div><div class="line">          <span class="attr">"name"</span>: <span class="string">"(TurnoverRate)"</span>,</div><div class="line">          <span class="attr">"dataIndex"</span>:<span class="number">8</span></div><div class="line">        &#125;</div><div class="line">      ]</div><div class="line">    &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>整个配置文件采用了Json的格式。其中”tbReqParams”里的每一条配置代码一个表格，例如：<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"tableName"</span>: <span class="string">"table1"</span>,    <span class="comment">//table名字，绑定时传送给datatable的table id</span></div><div class="line">    <span class="string">"requestParam"</span>: <span class="string">"xxxx"</span>,    <span class="comment">//Web API请求数据参数</span></div><div class="line">    <span class="string">"columns"</span>: <span class="string">"1-2-3-5-4"</span>    <span class="comment">//需要显示的列以及其顺序,索引从0开始</span></div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p><code>&quot;creatRowCallback&quot;: &quot;renderTableHelper.createRow&quot;</code>是用来动态绑定Datatables控件的createdRow事件的，主要用来改变表格中的样式（例如给数据添加颜色，加粗显示等）。主要实现代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">eval</span>(<span class="string">"var createRowCallB ="</span> + selected_table.creatRowCallback);</div><div class="line"><span class="keyword">var</span> t = $(tableParams.tableID).DataTable(</div><div class="line">        &#123;</div><div class="line">			......</div><div class="line">			createdRow: createRowCallB,</div><div class="line">		&#125;</div><div class="line">)</div><div class="line"></div><div class="line">createRow: <span class="function"><span class="keyword">function</span> (<span class="params">row, data, dataIndex</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.renderIndex;</div><div class="line">    <span class="keyword">var</span> minus = <span class="built_in">parseFloat</span>(data[index.CloseIndex]);</div><div class="line">    <span class="keyword">var</span> colorClose = getTextColor(minus);</div><div class="line">    $(<span class="string">'td'</span>, row).eq(index.CloseIndexDisplay).css(<span class="string">'color'</span>, colorClose);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中index.CloseIndex以及index.CloseIndexDisplay的定义与作用可见前端数据定制化小节。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">dtb<span class="string">": &#123;</span></div><div class="line">  "columns<span class="string">": [</span></div><div class="line">    &#123;</div><div class="line">      "<span class="built_in">title</span><span class="string">": "</span>市场<span class="string">",</span></div><div class="line">      "name<span class="string">": "</span>(MarketType)<span class="string">",</span></div><div class="line">      "dataIndex<span class="string">": 0</span></div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">      "<span class="built_in">title</span><span class="string">": "</span>代码<span class="string">",</span></div><div class="line">      "name<span class="string">": "</span>(<span class="built_in">Code</span>)<span class="string">",</span></div><div class="line">      "dataIndex<span class="string">": 1</span></div><div class="line">    &#125;,</div><div class="line">	......</div></pre></td></tr></table></figure>
<p>columns为对应的Web API返回的列的定义，title是显示的列头，name用来做定制化数据时使用，dataIndex用来标示该列对应Web API返回的数据的哪一列。</p>
<h2 id="前端数据定制化"><a href="#前端数据定制化" class="headerlink" title="前端数据定制化"></a>前端数据定制化</h2><p>由于前端显示的部分列需要做特殊处理，例如名称列需要加跳转链接，而跳转链接是由该条数据的市场(MarketType)，代码(Code)和url前缀拼接出来的。这里应用了Datatables中为每一列定义的render函数：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="built_in">var</span> j = <span class="number">0</span>; j &lt; selected_table.dtb.<span class="built_in">columns</span>.<span class="built_in">length</span>; j++) &#123;</div><div class="line">    <span class="built_in">eval</span>(<span class="string">"var a = "</span> + selected_table.dtb.<span class="built_in">columns</span>[j].render);</div><div class="line">    selected_table.dtb.<span class="built_in">columns</span>[j].render = a;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置文件中定义需要绑定的render函数<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">      <span class="attr">"title"</span>: <span class="string">"名称"</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"(Name)"</span>,</div><div class="line">      <span class="attr">"dataIndex"</span>: <span class="number">2</span>,</div><div class="line">      <span class="attr">"render"</span>: <span class="string">"renderCommon.getCommonCodeLink"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在Render函数定义文件Renders.js文件中定义相应函数：</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">var renderCommon = &#123;</div><div class="line">    ......</div><div class="line">	<span class="attribute">getCommonReleateLink</span>: function (data, type, row, meta) &#123;</div><div class="line">		return getSingleLink(gubaBaseUrl, '', row[meta<span class="variable">.settings</span><span class="variable">.nTable</span><span class="variable">.renderIndex</span><span class="variable">.CodeIndex</span>], "股吧") + ' '</div><div class="line">			+ getSingleLink(zjlBaseUrl, '', row[meta<span class="variable">.settings</span><span class="variable">.nTable</span><span class="variable">.renderIndex</span><span class="variable">.CodeIndex</span>], "资金流") + ' '</div><div class="line">			+ getSingleLink(yanbaoBaseUrl, '', row[meta<span class="variable">.settings</span><span class="variable">.nTable</span><span class="variable">.renderIndex</span><span class="variable">.CodeIndex</span>], "研报");</div><div class="line">	&#125;</div><div class="line">	......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里需要注意的是meta.settings.nTable.renderIndex.CodeIndex代表的是Code这列在绑定到Datatables之后的数据源中的索引，同样的上一节中提到的index.CloseIndex代表Close这列在绑定到Datatables之后的数据源中的索引。而index.CloseIndexDisplay代表的则是最终显示的时候Close这列的索引，这里大家可能会有疑问为什么CloseIndex和CloseDisplayIndex不一样呢？因为在对Name列做特殊处理的时候需要Code列的数据，所以在绑定Datatables数据源的时候采用的策略是所有的接口列都绑定进去，根据”columns”: “2-3-4-5-6”得到需要显示的列并把它的visible及bVisible属性置为true，而其他的则置为false。这样就造成了CloseIndex和CloseDisplayIndex不一样。<br>为了动态获取这些索引， 应用了Datatables的preDrawCallback函数。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">var</span> t = $(tableParams.tableID).DataTable(</div><div class="line">        &#123;</div><div class="line">			......</div><div class="line">			preDrawCallback: renderCommon<span class="selector-class">.getRenderColumnsIndex</span>,</div><div class="line">		&#125;</div><div class="line">)</div></pre></td></tr></table></figure>
<p>Renders.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> renderCommon = &#123;</div><div class="line"></div><div class="line">getRenderColumnsIndex: <span class="function"><span class="keyword">function</span> (<span class="params">settings</span>) </span>&#123;</div><div class="line">    settings.nTable.renderIndex = <span class="keyword">new</span> renderColIndex();</div><div class="line">    <span class="keyword">var</span> hidenCols = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; settings.aoColumns.length; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (settings.aoColumns[i].bVisible === <span class="literal">false</span>)</div><div class="line">            hidenCols += <span class="number">1</span>;</div><div class="line">        <span class="comment">//动态设置相应的Index及IndexDisplay</span></div><div class="line">        <span class="keyword">var</span> columnName = settings.aoColumns[i].sName.substr(<span class="number">1</span>, settings.aoColumns[i].sName.length - <span class="number">2</span>);</div><div class="line">        <span class="built_in">eval</span>(<span class="string">"settings.nTable.renderIndex."</span> + columnName + <span class="string">"Index = "</span> + i + <span class="string">";"</span>);</div><div class="line">        <span class="built_in">eval</span>(<span class="string">"settings.nTable.renderIndex."</span> + columnName + <span class="string">"IndexDisplay = "</span> + (i - hidenCols) + <span class="string">";"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">this</span>.renderIndex = settings.nTable.renderIndex;</div><div class="line">&#125;,</div><div class="line">......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="服务器端分页"><a href="#服务器端分页" class="headerlink" title="服务器端分页"></a>服务器端分页</h2><p>由于每页最多显示20条数据，如果每次都请求接口的所有数据的话。一来会造成资源浪费，二来也会降低程序的响应速度，所以最好是每次只请求需要的数据。关于Datatables服务器端分页定义及基本实现可见 <a href="http://datatables.club/manual/server-side.html" target="_blank" rel="external">服务器处理 Server-side processing</a>。当你打开服务器模式的时候，每次绘制表格的时候，DataTables 会给服务器发送一个请求（包括当前分页，排序，搜索参数等等）。DataTables 会向 服务器发送 一些参数 去执行所需要的处理，然后在服务器组装好 相应的数据 返回给 DataTables。<br>项目的数据返回接口已经存在了很久，并且会被其他项目或程序用到，是不能随便改动的。所以就不能应用常规的服务端分页实现方式。还好，接口支持传递page以及pageSize参数，同时提供能总条数total的返回。这里用到的是模拟服务端分页请求及返回来实现服务端分页功能的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">ajax: <span class="function"><span class="keyword">function</span> (<span class="params">data, callback, settings</span>) </span>&#123;</div><div class="line">                $.getScript(reqUrl, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> rawRecords = []; <span class="comment">//接口返回的数据</span></div><div class="line">                    <span class="keyword">var</span> data1 = <span class="built_in">eval</span>(jsDataName);</div><div class="line">                    <span class="keyword">var</span> obj = data1.rank;</div><div class="line">                    <span class="keyword">var</span> count = data1.pages;</div><div class="line">                    <span class="keyword">var</span> total = data1.total;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; obj.length; i++) &#123;</div><div class="line">                        <span class="keyword">var</span> temp = obj[i].split(<span class="string">","</span>);</div><div class="line">                        rawRecords.push(temp);</div><div class="line">                    &#125;					</div><div class="line">                    <span class="keyword">var</span> allRecords = [];  <span class="comment">//根据后端配置文件重新组合的用来显示的数据</span></div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; rawRecords.length; i++) <span class="comment">//一行数据</span></div><div class="line">                    &#123;</div><div class="line">                        <span class="keyword">var</span> adjustRow = [];</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; adjustColumn.length; j++) &#123;</div><div class="line">                            <span class="keyword">if</span> (adjustColumn[j].dataIndex != <span class="number">-1</span>) &#123;</div><div class="line">                                adjustRow.push(rawRecords[i][adjustColumn[j].dataIndex]);</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                adjustRow.push(<span class="number">0</span>);</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                        allRecords.push(adjustRow);</div><div class="line">                    &#125;				</div><div class="line">					<span class="comment">//模拟服务器返回的数据结构</span></div><div class="line">                    <span class="keyword">var</span> returnData = &#123;&#125;;</div><div class="line">                    returnData.draw = data.draw;<span class="comment">//这里直接自行返回了draw计数器,本来应该由后台返回</span></div><div class="line">                    returnData.recordsTotal = total;<span class="comment">//返回数据全部记录</span></div><div class="line">                    returnData.recordsFiltered = total;<span class="comment">//后台不实现过滤功能，每次查询均视作全部结果</span></div><div class="line">                    returnData.data = allRecords;<span class="comment">//返回的数据列表</span></div><div class="line">                    callback(returnData);</div><div class="line">                &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其实也就是自己封装服务器需要返回的数据(Returned data)，并调用calllback。当然，得先开启服务器端分页功能，设置serverSide: true。</p>
<h2 id="一点建议"><a href="#一点建议" class="headerlink" title="一点建议"></a>一点建议</h2><p>由于Datatables控件比较复杂，所以要想很好的去掌握它，除了认真的去研读它的文档，最重要的是要善于运用浏览器的调试功能，多加断点，这样才能看清每一个函数或结构所返回的数据，进而得到自己可以用的属性或api。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2017/12/25/前端表格插件DataTables使用小记/" data-id="cjfuuekt3000h1cl1oy554lzu" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Datatables，前端表格，开源/">Datatables，前端表格，开源</a></div><div class="post-nav"><a href="/2018/01/05/doNET异步编程杂谈（转）/" class="pre">.NET异步编程杂谈（转）</a><a href="/2017/12/21/C sharp调用C++ dll之PInvoke点滴总结/" class="next">C#调用C++ dll之P/Invoke点滴总结</a></div><div data-thread-key="2017/12/25/前端表格插件DataTables使用小记/" data-title="前端表格插件DataTables使用小记" data-url="http://yoursite.com/2017/12/25/前端表格插件DataTables使用小记/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/12/25/前端表格插件DataTables使用小记/" data-title="前端表格插件DataTables使用小记" data-url="http://yoursite.com/2017/12/25/前端表格插件DataTables使用小记/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Nhibernate-Timeout/" style="font-size: 15px;">Nhibernate, Timeout</a> <a href="/tags/C-C-P-Invoke-ip2region/" style="font-size: 15px;">C#, C++, P/Invoke, ip2region</a> <a href="/tags/C-C-P-Invoke/" style="font-size: 15px;">C#, C++, P/Invoke</a> <a href="/tags/EdgeCast-FTP/" style="font-size: 15px;">EdgeCast, FTP</a> <a href="/tags/Openssl-fPIC-sha1-block-data-order-crash/" style="font-size: 15px;">Openssl, fPIC, sha1_block_data_order, crash</a> <a href="/tags/Akamai-Fast-Purge/" style="font-size: 15px;">Akamai,Fast Purge</a> <a href="/tags/NET-异步编程/" style="font-size: 15px;">.NET, 异步编程</a> <a href="/tags/Delta-Encoding-差量更新-VCDiff-Rtpatch/" style="font-size: 15px;">Delta Encoding, 差量更新, VCDiff, Rtpatch</a> <a href="/tags/2G-Big-File-Size-大文件/" style="font-size: 15px;">2G, Big File Size, 大文件</a> <a href="/tags/Datatables，前端表格，开源/" style="font-size: 15px;">Datatables，前端表格，开源</a> <a href="/tags/监控-数据库监控-应用监控/" style="font-size: 15px;">监控, 数据库监控, 应用监控</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/监控系统杂谈/">监控系统杂谈</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/26/ASP.NET调用开源ip地址库ip2region小记/">ASP.NET调用开源ip地址库ip2region小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/05/doNET异步编程杂谈（转）/">.NET异步编程杂谈（转）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/前端表格插件DataTables使用小记/">前端表格插件DataTables使用小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/21/C sharp调用C++ dll之PInvoke点滴总结/">C#调用C++ dll之P/Invoke点滴总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/18/OpenSSL与fPIC/">OpenSSL与fPIC</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/Nhibernate batch query timeout问题的解决/">Nhibernate batch query timeout问题的解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/二进制差量更新算法比较/">二进制差量更新算法比较</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/23/下载（2G以上）大文件支持小记/">下载（2G以上）大文件支持小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/20/Akamai CCU V3 Fast Purge/">Akamai CCU V3 Fast Purge</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">红尘漫步.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'justinzhou11'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>