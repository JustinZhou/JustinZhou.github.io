<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="我要一步一步往上爬，在最高点乘着叶片往前飞"><title>Akamai CCU V3 Fast Purge | 红尘漫步</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Akamai CCU V3 Fast Purge</h1><a id="logo" href="/.">红尘漫步</a><p class="description">爱吃鱼的小强</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Akamai CCU V3 Fast Purge</h1><div class="post-meta">Aug 17, 2016<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/08/17/Akamai CCU V3 Fast Purge/" href="/2016/08/17/Akamai CCU V3 Fast Purge/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Concept"><span class="toc-number">1.</span> <span class="toc-text">Concept</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage"><span class="toc-number">2.</span> <span class="toc-text">Usage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Authorize-client"><span class="toc-number">2.1.</span> <span class="toc-text">Authorize client</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CCU-request"><span class="toc-number">2.2.</span> <span class="toc-text">CCU request</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Signing-API-request"><span class="toc-number">2.3.</span> <span class="toc-text">Signing API request</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Signing-Key"><span class="toc-number">2.3.1.</span> <span class="toc-text">Signing Key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Example-Data-to-Sign"><span class="toc-number">2.3.2.</span> <span class="toc-text">Example Data to Sign</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#More-information"><span class="toc-number">2.4.</span> <span class="toc-text">More information</span></a></li></ol></li></ol></div></div><div class="post-content"><h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><p>Akamai是著名的CDN内容提供商。它提供了一套purge的API用于清空Edge Server上的缓存，使客户可以拿到最新的内容。目前在用的是CCU OPEN V2 API，主要是基于XML或JASON的一套REST API。通过调用它，会将相应的purge请求加入一个队列中，同时它也提供了query status的API用于查询purge请求的状态。一般情况下，从提交请求到请求执行完成需要4-7min。<br>这里想要介绍的是Akamai那边提供的V3版本的API，目前处于Beta阶段。最大的卖点就是Fast Purge - Featuring 5-second purge。<br><a id="more"></a></p>
<ul>
<li>Purge utility is Fast Purge, if enabled on the account (estimated time is approximately five seconds). If Fast Purge is not properly enabled on the account, the purge is processed using the legacy (v2) CCU version (estimated time is approximately 4–7 minutes).*</li>
<li>Purges are processed instantaneously - there is no longer a notion of a queue, neither “default” nor “emergency”.*</li>
<li>You can add objects to a total of 50K per request.*</li>
<li>You can choose to “invalidate” or “delete”.*</li>
<li>“production” and “staging” can be purged as separate commands.  This is detailed further down in this post.*</li>
<li>The V3 code will work even before the fast purge is turned on for your properties, so you can implement the code and turn on the functionality as soon as it’s ready.  These calls will be redirected to the V2 OPEN API on the back end.*</li>
</ul>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><h3 id="Authorize-client"><a href="#Authorize-client" class="headerlink" title="Authorize client"></a>Authorize client</h3><p>OPEN API clients interact with the Akamai Intelligent Platform™ by signing each API request with credentials that are created specifically for each OPEN API client. The scope of the authorization is managed by you. These credentials are analogous to other types of system private data, such as ssh keys, and should be treated with the same care.<br>The authorization to call an API is managed in the Akamai Luna Control Center; however, not every Luna Control Center user will have permissions to create API authorizations. In order to manage API credentials, a user must have the Admin role in the context (account level or group level) the credentials will be tied to. Different organizations choose to grant this privilege to different classes of users. If you don’t see the Manage APIs menu item in the instructions below, then you may not have permission to manage API authorizations. If you find this to be the case, please consult your local administrator. They can either create the authorization you will need for this exercise, or they may grant you the permission to create API authorizations as appropriate to your organization.<br><strong>steps</strong></p>
<ol>
<li>Create an API client</li>
<li>Grant that client permission to call the API we are working with</li>
<li>Save our work to the Akamai Intelligent Platform</li>
<li>Download the authentication tokens so the local API client can use them to sign the API requests (client-api-kickstart.txt: contains Base URL, Access Tokens, Client token, and Secret)</li>
</ol>
<hr>
<h3 id="CCU-request"><a href="#CCU-request" class="headerlink" title="CCU request"></a>CCU request</h3><p>Purge methods (Invalidate or Delete by URL) currently available with this API by task type, as well as an estimated completion time, are as follows:</p>
<table>
<thead>
<tr>
<th style="text-align:left"><em>Action</em></th>
<th style="text-align:left"><em>Operation</em></th>
<th style="text-align:left"><em>API EndPoint</em></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Invalidate by URL</td>
<td style="text-align:left">POST</td>
<td style="text-align:left">/ccu/v3/invalidate/url/{network}</td>
</tr>
<tr>
<td style="text-align:left">Delete by URL</td>
<td style="text-align:left">POST</td>
<td style="text-align:left">/ccu/v3/delete/url/{network}</td>
</tr>
</tbody>
</table>
<p><strong>Invalidate by URL</strong><br>Request:<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">POST  <span class="meta-keyword">/ccu/</span>v3<span class="meta-keyword">/invalidate/</span>url/production</div><div class="line">Content-Type: application/<span class="class">json</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"objects"</span>: [</div><div class="line">        <span class="string">"http://www.example.com/graphics/picture.gif"</span>,</div><div class="line">        <span class="string">"http://www.site-example.com/graphics/picture.gif"</span>,</div><div class="line">        <span class="string">"http://www.example1.com/documents/brochure.pdf"</span> </div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Response：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"httpStatus"</span>: <span class="number">201</span>,</div><div class="line">    <span class="attr">"detail"</span>: <span class="string">"Request accepted."</span>,</div><div class="line">    <span class="attr">"estimatedSeconds"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"purgeId"</span>: <span class="string">"043f-4af0-843f-aaf0043faaf0"</span>,</div><div class="line">    <span class="attr">"supportId"</span>: <span class="string">"17PY1321286429616716-211907680"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>Delete by URL</strong><br>Request:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">POST  /ccu/v3/<span class="keyword">delete</span>/<span class="keyword">url</span>/production</div><div class="line"><span class="keyword">Content</span>-<span class="keyword">Type</span>: application/<span class="keyword">json</span></div><div class="line">&#123;</div><div class="line">    <span class="string">"objects"</span>: [</div><div class="line">        <span class="string">"http://www.example.com/graphics/picture.gif"</span>,</div><div class="line">        <span class="string">"http://www.site-example.com/graphics/picture.gif"</span>,</div><div class="line">        <span class="string">"http://www.example1.com/documents/brochure.pdf"</span></div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Response:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"httpStatus"</span>: <span class="number">201</span>,</div><div class="line">    <span class="attr">"detail"</span>: <span class="string">"Request accepted."</span>,</div><div class="line">    <span class="attr">"estimatedSeconds"</span>: <span class="number">5</span>,</div><div class="line">    <span class="attr">"purgeId"</span>: <span class="string">"043f-4af0-843f-aaf0043faaf0"</span>,</div><div class="line">    <span class="attr">"supportId"</span>: <span class="string">"17PY1321286429616716-211907680"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="Signing-API-request"><a href="#Signing-API-request" class="headerlink" title="Signing API request"></a>Signing API request</h3><p>The signature is the base64-encoding of the SHA–256 HMAC of the data to sign with the signing key.<br>You can get an <a href="https://github.com/akamai-open" target="_blank" rel="external">EdgeGrid Request Signature Module</a>.</p>
<h4 id="Signing-Key"><a href="#Signing-Key" class="headerlink" title="Signing Key"></a>Signing Key</h4><p>The signing key is derived from the client secret. The signing key is computed as the base64 encoding of the SHA–256 HMAC of the timestamp string (the field value included in the HTTP authorization header described above) with the client secret as the key.<br><img src="/img/CCU_V3_WorkFlow.jpg" alt="Akamai CCU V3 WorkFlow"></p>
<h4 id="Example-Data-to-Sign"><a href="#Example-Data-to-Sign" class="headerlink" title="Example Data to Sign"></a>Example Data to Sign</h4><p>Raw CCU v3 request:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/diagnostic-tools/<span class="built_in">v1</span>/locations</div></pre></td></tr></table></figure></p>
<p>the data to sign looks like this (\t represents a tab, line breaks added for readability):<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">GET<span class="symbol">\t</span>https<span class="symbol">\t</span>akaa-xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx.luna.akamaiapis.net<span class="symbol">\t</span></div><div class="line">/diagnostic-tools/v1/locations<span class="symbol">\t</span><span class="symbol">\t</span><span class="symbol">\t</span>EG1-HMAC-SHA256</div><div class="line">client_token=akab-xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx;</div><div class="line">access_token=akab-xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx;</div><div class="line">timestamp=20140402T18:05:06+0000;</div><div class="line">nonce=185f94eb-537c-4c01-b8cc-2fa5a06aee7f;</div></pre></td></tr></table></figure></p>
<h3 id="More-information"><a href="#More-information" class="headerlink" title="More information"></a>More information</h3><p><a href="https://developer.akamai.com/api/purge/ccu/overview.html" target="_blank" rel="external">https://developer.akamai.com/api/purge/ccu/overview.html</a><br><a href="https://developer.akamai.com/introduction/Client_Auth.html" target="_blank" rel="external">https://developer.akamai.com/introduction/Client_Auth.html</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2016/08/17/Akamai CCU V3 Fast Purge/" data-id="cjblxk8bz0001y0l1bezepmme" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Akamai-Fast-Purge/">Akamai,Fast Purge</a></div><div class="post-nav"><a href="/2016/08/17/EdgeCast FTP Upload文件size变小问题的解决/" class="pre">EdgeCast FTP Upload文件size变小问题的解决</a></div><div data-thread-key="2016/08/17/Akamai CCU V3 Fast Purge/" data-title="Akamai CCU V3 Fast Purge" data-url="http://yoursite.com/2016/08/17/Akamai CCU V3 Fast Purge/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/08/17/Akamai CCU V3 Fast Purge/" data-title="Akamai CCU V3 Fast Purge" data-url="http://yoursite.com/2016/08/17/Akamai CCU V3 Fast Purge/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Akamai-Fast-Purge/" style="font-size: 15px;">Akamai,Fast Purge</a> <a href="/tags/C-C-P-Invoke/" style="font-size: 15px;">C#, C++, P/Invoke</a> <a href="/tags/EdgeCast-FTP/" style="font-size: 15px;">EdgeCast, FTP</a> <a href="/tags/Nhibernate-Timeout/" style="font-size: 15px;">Nhibernate, Timeout</a> <a href="/tags/Openssl-fPIC-sha1-block-data-order-crash/" style="font-size: 15px;">Openssl, fPIC, sha1_block_data_order, crash</a> <a href="/tags/2G-Big-File-Size-大文件/" style="font-size: 15px;">2G, Big File Size, 大文件</a> <a href="/tags/Delta-Encoding-差量更新-VCDiff-Rtpatch/" style="font-size: 15px;">Delta Encoding, 差量更新, VCDiff, Rtpatch</a> <a href="/tags/Datatables，前端表格，开源/" style="font-size: 15px;">Datatables，前端表格，开源</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/22/前端表格插件DataTables使用小记/">前端表格插件DataTables使用小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/21/C sharp调用C++ dll之PInvoke点滴总结/">C#调用C++ dll之P/Invoke点滴总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/06/Nhibernate batch query timeout问题的解决/">Nhibernate batch query timeout问题的解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/30/二进制差量更新算法比较/">二进制差量更新算法比较</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/26/OpenSSL与fPIC/">OpenSSL与fPIC</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/24/下载（2G以上）大文件支持小记/">下载（2G以上）大文件支持小记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/EdgeCast FTP Upload文件size变小问题的解决/">EdgeCast FTP Upload文件size变小问题的解决</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/17/Akamai CCU V3 Fast Purge/">Akamai CCU V3 Fast Purge</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">红尘漫步.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'justinzhou11'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>